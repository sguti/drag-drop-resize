!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("rxjs"),require("rxjs/operators"),require("@angular/core")):"function"==typeof define&&define.amd?define("dragy",["exports","@angular/common","rxjs","rxjs/operators","@angular/core"],t):t(e.dragy={},e.ng.common,e.rxjs,e.rxjs.operators,e.ng.core)}(this,function(e,t,n,p,r){"use strict";var i=function(){function e(){this.widgetRegistry={},this.dragEventRegistry={},this.viewContainerRegistry={}}return e.prototype.registerWidget=function(e){return!(!e.widgetId||this.widgetRegistry[e.widgetId])&&(this.widgetRegistry[e.widgetId]=e,!0)},e.prototype.unRegisterWidget=function(e){return delete this.widgetRegistry[e]},e.prototype.getWidgetConfig=function(e){return this.widgetRegistry[e]},e.prototype.addDragData=function(e,t){this.dragEventRegistry[e]=t},e.prototype.getDragData=function(e){return this.dragEventRegistry[e]},e.prototype.clearDragData=function(e){return delete this.dragEventRegistry[e]},e.prototype.addViewContainerItem=function(e,t){this.viewContainerRegistry[e]=t},e.prototype.getViewContainerItem=function(e){return this.viewContainerRegistry[e]},e.prototype.getAllViewContainerItem=function(){var t=this;return Object.keys(this.viewContainerRegistry).map(function(e){return t.viewContainerRegistry[e]})},e.prototype.removeViewContainerItem=function(e){return delete this.viewContainerRegistry[e]},e.prototype.checkViewContainerItemEntry=function(e){return e in this.viewContainerRegistry},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=r.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),o=function(){function e(e,t){this.elementRef=e,this.internalRegistry=t,this.registered=!1}return e.prototype.ngOnInit=function(){this.internalRegistry.registerWidget(this.config)?(this.registered=!0,this.elementRef.nativeElement.setAttribute("draggable","true")):(console.error("Widget id "+this.config.widgetId+" is not unique"),this.showInvalidWidget())},e.prototype.ngOnDestroy=function(){this.internalRegistry.unRegisterWidget(this.config.widgetId)},e.prototype.showInvalidWidget=function(){var e=this,t=this.elementRef.nativeElement.style.border;this.elementRef.nativeElement.style.border="2px solid red",setTimeout(function(){e.elementRef.nativeElement.style.border=t},2e3)},e.prototype.mouseDownHandler=function(e){this.registered&&(this.offsetX=e.offsetX,this.offsetY=e.offsetY,console.log("x: "+this.offsetX+",y : "+this.offsetY))},e.prototype.dragStartHandler=function(e){if(this.registered){this.config.dragImage;var t="drag_"+Math.floor(9999999*Math.random())+1;this.internalRegistry.addDragData(t,{offsetX:this.offsetX,offsetY:this.offsetY,widgetId:this.config.widgetId}),e.dataTransfer.setData(t,t)}},e.prototype.dragEndHandler=function(e){},e.decorators=[{type:r.Directive,args:[{selector:"[gDraggable]"}]}],e.ctorParameters=function(){return[{type:r.ElementRef},{type:i}]},e.propDecorators={config:[{type:r.Input,args:["gConfig"]}],mouseDownHandler:[{type:r.HostListener,args:["mousedown",["$event"]]}],dragStartHandler:[{type:r.HostListener,args:["dragstart",["$event"]]}],dragEndHandler:[{type:r.HostListener,args:["dragend",["$event"]]}]},e}(),s=function(){function e(e,t,n){var s=this;this.elementRef=e,this.renderer=t,this.internalRegistry=n,this.isAlive=!0,this.validDropTarget=!0,this.dropsuccess=new r.EventEmitter,this.dragOverHandler=function(e){e.preventDefault(),console.log(e);var t=s.elementRef.nativeElement.getBoundingClientRect(),n=e.clientX-t.left-s._current.dragData.offsetX,r=n+s._current.config.componentWidth,i=e.clientY-t.top-s._current.dragData.offsetY,o=i+s._current.config.componentHeight;s.validDropTarget=!s.internalRegistry.getAllViewContainerItem().some(function(e){return e.startX<r&&e.endX>n&&e.startY<o&&e.endY>i}),s._tempDropLocation.style.top=i+"px",s._tempDropLocation.style.left=n+"px",s._tempDropLocation.style.borderColor=s.validDropTarget?"Green":"Red"}}return e.prototype.ngOnInit=function(){var e=this;this._tempDropLocation=document.createElement("div"),this._tempDropLocation.style.border="2px dashed green",this._tempDropLocation.style.position="absolute",n.fromEvent(this.elementRef.nativeElement,"dragover").pipe(p.takeWhile(function(){return e.isAlive}),p.tap(function(e){return e.preventDefault()}),p.distinctUntilChanged(function(e,t){return e.clientX===t.clientX&&e.clientY===t.clientY}),p.debounce(function(){return n.timer(100)})).subscribe(this.dragOverHandler)},e.prototype.ngOnDestroy=function(){this.isAlive=!1},e.prototype.dragEnterHandler=function(e){e.preventDefault(),e.dataTransfer.dropEffect="move";var t=e.dataTransfer.types[0],n=this.internalRegistry.getDragData(t),r=this.internalRegistry.getWidgetConfig(n.widgetId);this._current={eventId:e.dataTransfer.types[0],dragData:this.internalRegistry.getDragData(t),config:this.internalRegistry.getWidgetConfig(n.widgetId)},this._tempDropLocation.style.height=r.componentHeight+"px",this._tempDropLocation.style.width=r.componentWidth+"px",this.renderer.appendChild(this.elementRef.nativeElement,this._tempDropLocation)},e.prototype.dragLeaveHandler=function(e){console.log("drag leave")},e.prototype.dropHandler=function(e){if(e.preventDefault(),this.validDropTarget){var t={event:e,componentName:this._current.config.componentName,dragSourceSelector:this._current.config.widgetId,widgetId:this._current.config.widgetId,style:{position:"absolute","top.px":this._tempDropLocation.style.top.replace(/px/,""),"left.px":this._tempDropLocation.style.left.replace(/px/,"")}};this.dropsuccess.emit(t)}this.renderer.removeChild(this.elementRef.nativeElement,this._tempDropLocation)},e.decorators=[{type:r.Directive,args:[{selector:"[gDroppable]"}]}],e.ctorParameters=function(){return[{type:r.ElementRef},{type:r.Renderer2},{type:i}]},e.propDecorators={dropsuccess:[{type:r.Output}],dragEnterHandler:[{type:r.HostListener,args:["dragenter",["$event"]]}],dragLeaveHandler:[{type:r.HostListener,args:["dragleave",["$event"]]}],dropHandler:[{type:r.HostListener,args:["drop",["$event"]]}]},e}(),a=function(){function e(){this.registry=new Set}return e.prototype.register=function(e,t){return this.registry[e]&&console.warn(e+" already exists in registry. Will be overwriten."),this.registry[e]=t,this},e.prototype.get=function(e){return this.registry[e]},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=r.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),c=function(){function e(e,t){this.resolver=e,this.registry=t}return e.prototype.componentFactory=function(e){return this.resolver.resolveComponentFactory(this.registry.get(e))},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:r.ComponentFactoryResolver},{type:a}]},e.ngInjectableDef=r.defineInjectable({factory:function(){return new e(r.inject(r.ComponentFactoryResolver),r.inject(a))},token:e,providedIn:"root"}),e}(),d=function(){function e(e,t){this.gComponentFactoryService=e,this.internalRegistry=t,this.update=new r.EventEmitter}return e.prototype.ngOnInit=function(){},e.prototype.ngOnChanges=function(e){if("state"in e&&e.state.firstChange)for(var t in this.state.items)if(this.state.items.hasOwnProperty(t)){var n=this.state.items[t];this.projectWidgetInView(n.widgetId,n.componentName,n.style)}},e.prototype.dropsuccessHandler=function(e){if(this.internalRegistry.checkViewContainerItemEntry(e.widgetId))return console.error("This widget is alrady pojected in view");this.projectWidgetInView(e.widgetId,e.componentName,e.style),this.state.items[e.widgetId]={componentName:e.componentName,style:e.style,widgetId:e.widgetId},this.state.length+=1,this.update.emit(this.state)},e.prototype.projectWidgetInView=function(e,t,n){var r=this,i=this.gComponentFactoryService.componentFactory(t),o=this.container.createComponent(i),s=o.instance;s.widgetId=e,s.style=n,s._remove.pipe(p.takeWhile(function(e){return s.isActive}),p.first()).subscribe(function(e){r.container.remove(r.internalRegistry.getViewContainerItem(e).viewContainerIndex),r.internalRegistry.removeViewContainerItem(e),delete r.state.items[e],r.state.length-=1,r.update.emit(r.state)});var a=getComputedStyle(o.location.nativeElement.children[0]);this.internalRegistry.addViewContainerItem(e,{viewContainerIndex:this.container.length-1,startX:+n["left.px"],startY:+n["top.px"],endX:+n["left.px"]+ +a.width.replace(/px/,""),endY:+n["top.px"]+ +a.height.replace(/px/,"")})},e.decorators=[{type:r.Component,args:[{selector:"g-drop-zone",template:'\n    <div (dropsuccess)="dropsuccessHandler($event)" gDroppable>\n      <template #dropContainer></template>\n    </div>\n  ',changeDetection:r.ChangeDetectionStrategy.OnPush,styles:["\n      div {\n        width: 100%;\n        height: 100%;\n      }\n      div * {\n        pointer-events: none;\n      }\n    "]}]}],e.ctorParameters=function(){return[{type:c},{type:i}]},e.propDecorators={state:[{type:r.Input}],update:[{type:r.Output}],container:[{type:r.ViewChild,args:["dropContainer",{read:r.ViewContainerRef}]}]},e}(),g=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{declarations:[o,s,d],imports:[t.CommonModule],providers:[c,i],exports:[o,s,d]}]}],e}(),l=function(){function e(){this.isActive=!0,this._remove=new r.EventEmitter}return e.prototype.remove=function(){this._remove.emit(this.widgetId)},e.prototype.ngOnDestroy=function(){this.isActive=!1},e.propDecorators={widgetId:[{type:r.Input}],style:[{type:r.Input}],_remove:[{type:r.Output}]},e}(),u=function w(){},f=function D(){},y=function I(){},h=function R(){this.length=0,this.items={}},m=function C(){},v=function b(){};e.DragyModule=g,e.DropZoneComponent=d,e.DraggableDirective=o,e.DroppableDirective=s,e.IWidgetProjection=l,e.DragData=u,e.DraggableDirectiveConfig=f,e.DropSuccessSyntheticEvent=y,e.DropZoneState=h,e.DropZoneItem=m,e.ViewContainerItem=v,e.GComponentRegistryService=a,e.ɵc=d,e.ɵa=o,e.ɵb=s,e.ɵd=c,e.ɵe=i,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=dragy.umd.min.js.map